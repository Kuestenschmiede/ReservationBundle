function getWeekdate(e){var t,r,i,n;return 0<e.indexOf(".")?(r=(t=e.split("."))[2],i=t[1],n=t[0],e=(r=r&&2==r.length?"20"+r:r)+"/"+(i=i<10?"0"+i:i)+"/"+(n=n<10?"0"+n:n)):0<e.indexOf("/")&&(r=(t=e.split("/"))[2],i=t[1],n=t[0],e=(r=r&&2==r.length?"20"+r:r)+"/"+(i=i<10?"0"+i:i)+"/"+(n=n<10?"0"+n:n)),new Date(e).getDay()}function isWeekday(e,t){e=e.split("--");return!!(e&&e[0]&&e[1]&&getWeekdate(e[0])==e[1])}function setObjectId(e,t,r=0){var i,n=!!e&&jQuery(e).attr("data-object"),a=t,l=document.getElementById("c4g_reservation_object_"+a),d=jQuery(document.getElementsByClassName("displayReservationObjects")),t="";return l&&(jQuery(l).show(),d&&d.show(),n&&(i=n.split("-"),jQuery(e).is(":disabled")||(!jQuery(l).val()||jQuery(l).val()<=0)&&(jQuery(l).val(i[0]),jQuery(l).attr("value",i[0])),jQuery(l).change(),t=i||t)),hideOptions(a,t,r),!0}function hideOptions(e,t,r){var n;-1==e&&(e=(n=document.getElementById("c4g_reservation_type"))?n.value:-1);var a=document.getElementById("c4g_reservation_object_"+e),l=-1,d=0;if(a){var s=0;for(i=0;i<a.options.length;i++){var o=a.options[i],u=o.getAttribute("min")?parseInt(o.getAttribute("min")):1,c=o.getAttribute("max")?parseInt(o.getAttribute("max")):0,y=document.getElementById("c4g_desiredCapacity_"+e),v=y?y.value:0,m=v-u,y=c-v,h=y<m?m:y,g=!1;if(jQuery.isArray(t)){if(u&&v&&0<v&&u<=v&&v<=c)for(j=0;j<t.length;j++)t[j]==o.value&&(!s||0==s||h&&0<h&&h<s)&&(s=h||s,d=t[j],g=!0);else for(j=0;j<t.length;j++)if(t[j]==o.value){0==j&&(d=t[j]),g=!0;break}}else 0<=parseInt(t)&&t==o.value&&(d=t,g=!0);if(g||-1==o.value?-1!=o.value&&(jQuery(a).children('option[value="'+o.value+'"]').removeAttr("disabled"),jQuery(a).children('option[value="'+o.value+'"]').removeAttr("hidden"),u&&v&&0<v&&(v<u||c&&c<v)?(jQuery(a).children('option[value="'+o.value+'"]').attr("disabled","disabled"),jQuery(a).children('option[value="'+o.value+'"]').attr("hidden","hidden")):(jQuery(a).children('option[value="'+o.value+'"]').removeAttr("disabled"),jQuery(a).children('option[value="'+o.value+'"]').removeAttr("hidden"),0<=d&&o.value==d?l=d:-1==l&&-1!=o.value&&(l=o.value))):(jQuery(a).children('option[value="'+o.value+'"]').attr("disabled","disabled"),jQuery(a).children('option[value="'+o.value+'"]').attr("hidden","hidden")),r&&-1!=o.value&&g){var c=jQuery(a).children('option[value="'+o.value+'"]').text(),p="",f="",_=document.querySelectorAll(".c4g__form-date-container .c4g_beginDate_"+e);if(_)for(k=0;k<_.length;k++){var Q=_[k];if(Q&&Q.value){p=Q.value;break}}var b=jQuery(".reservation_time_button_"+e+' input[type = "radio"]:checked');if(b)for(k=0;k<b.length;k++){var I=b[k];if(I){I=jQuery('label[for="'+jQuery(I).attr("id")+'"]'),f=I?I[0].firstChild.nodeValue:"";break}}c&&""!=p&&""!=f&&(-1!=(v=c.lastIndexOf(" ("))&&(c=c.substr(0,v)),jQuery(a).children('option[value="'+o.value+'"]').text(c+" ("+p+" "+f+")"))}}!jQuery(a).is(":disabled")&&jQuery(a).val()&&0<=jQuery(a).val()&&(l=jQuery(a).val()),0<=parseInt(l)?(jQuery(a).val(l).change(),jQuery(a).children('option[value="'+l+'"]').removeAttr("disabled"),jQuery(a).children('option[value="'+l+'"]').removeAttr("hidden"),jQuery(a).children('option[value="-1"]').attr("disabled","disabled"),jQuery(a).children('option[value="-1"]').attr("hidden","hidden"),jQuery(a).removeAttr("disabled")):(jQuery(a).children('option[value="-1"]').removeAttr("disabled"),jQuery(a).children('option[value="-1"]').removeAttr("hidden"),jQuery(a).val("-1").change(),jQuery(a).prop("disabled",!0))}checkEventFields()}function checkType(e,t){return t?!!jQuery(e).parent().parent().hasClass("begindate-event"):!!jQuery(e).parent().parent().hasClass("begin-date")}function setReservationForm(e,t){jQuery(".reservation-id").hide();var r=!1,n=!1,a=document.getElementById("c4g_reservation_type");e=a?a.value:-1;var l=a.selectedIndex,l=a.options[l];if(l&&(r=2==l.getAttribute("type"),n=3==l.getAttribute("type")),0<e){l=jQuery("#c4g_desiredCapacity_"+e);l&&(d=l.val(),l.attr("max")&&d>parseInt(l.attr("max"))&&l.val(l.attr("max")),l.attr("min")&&d<parseInt(l.attr("min"))&&l.val(l.attr("min")));var d,l=jQuery("#c4g_duration_"+e);l&&l.is(":visible")&&(d=l.val(),l.attr("max")&&d>parseInt(l.attr("max"))&&l.val(l.attr("max")),l.attr("min")&&d<parseInt(l.attr("min"))&&l.val(l.attr("min")));l="c4g_beginDate_"+e;if(n){var s=document.getElementById("c4g_reservation_object_"+e);s&&(l=l+"-33"+s.value,setTimeset(document.getElementById(l),e,t))}else if(r){s=window.location.search;const y=new URLSearchParams(s);s=y.get("event");if(s){l="c4g_beginDateEvent_"+e+"-22"+s;document.getElementById(l)&&(setTimeset(document.getElementById(l),e,t),checkEventFields())}else{var o=document.getElementsByClassName("c4g__form-date-input");if(o)for(i=0;i<o.length;i++){var u=o[i];if(u&&checkType(u,r)&&u.value){var c=u.id;if(c&&c.indexOf("c4g_beginDateEvent_"+e+"-22")){setTimeset(u,e,t),checkEventFields();break}}}}}else document.getElementById(l)&&setTimeset(document.getElementById(l),e,t)}handleBrickConditions(),document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}function checkTimelist(n,a){var l=-1;if(n&&a)for(idx=0;idx<a.length;idx++){let i=0;if(a[idx]){let e=[],t=a[idx].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let r=[];if((n=n.toString()).indexOf("#")?r=n.split("#"):r[0]=n,parseInt(e[0])===parseInt(r[0])&&(l=idx,i++),e[1]&&r[1]){var d=parseInt(e[0]),s=d+parseInt(e[1]),o=parseInt(r[0]),u=o+parseInt(r[1]);if(d<=o&&o<s&&(l=idx,i++),d<u&&u<=s&&(l=idx,i++),3==i)break}}else if(1==i)break}return l}function checkMax(n,a,l,d,s,e){let o=!0;var u,c,v,m,e=n[a][l].act+parseInt(e);if(n[a][l].max&&e<=n[a][l].max){for(y=0;y<n.length;y++)if(d&&s&&y!=a){let e=[],t=s[y].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let r=[];(d=d.toString()).indexOf("#")?r=d.split("#"):r[0]=d;let i=!1;if(parseInt(e[0])===parseInt(r[0])?i=!0:e[1]&&r[1]&&(c=(u=parseInt(e[0]))+parseInt(e[1]),m=(v=parseInt(r[0]))+parseInt(r[1]),(u<=v&&v<c||u<m&&m<=c)&&(i=!0)),i)for(z=0;z<n[y].length;z++)if(n[y][z].max&&n[y][z].act>=n[y][z].max||n[y][z].act+n[a][l].act>=n[a][l].max)return!1;o=!0}}else o=!n[a][l].max;return o}function shuffle(e){let t=e.length;for(;0<t;){var r=Math.floor(Math.random()*t);t--;var i=e[t];e[t]=e[r],e[r]=i}return e}function isElementReallyShowed(e){var t=!(jQuery(e).is(":disabled")||jQuery(e).is(":hidden")||"hidden"==jQuery(e).css("visibility"));return jQuery(e).parents().each(function(){t=t&&!jQuery(e).is(":disabled")&&!jQuery(this).is(":hidden")&&!("hidden"==jQuery(this).css("visibility"))}),t}function setTimeset(e,q,L){var P=0,U=-1,V=0;-1==q?(jQuery(document.getElementsByClassName("reservation_time_button"))&&jQuery(document.getElementsByClassName("reservation_time_button")).hide(),jQuery(document.getElementsByClassName("displayReservationObjects"))&&jQuery(document.getElementsByClassName("displayReservationObjects")).hide()):(e?e.id&&e.id.indexOf("-33")&&-1!=e.id.indexOf("-33")&&(V=e.id.substr(e.id.indexOf("-33")+3)):e=document.getElementById("c4g_beginDate_"+q),P=e?e.value:0);var t,G,e=document.getElementById("c4g_duration_"+q);e&&jQuery(e).is(":visible")&&(t=e.value),(P=P&&P.indexOf("/")?(P=P.replace("/","~")).replace("/","~"):P)&&q&&(t=t||-1,G=!(document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="flex"),fetch("/reservation-api/currentTimeset/"+P+"/"+q+"/"+t+"/"+V).then(e=>e.json()).then(e=>{var t=document.getElementById("c4g_beginTime_"+q+"-00"+getWeekdate(P)),r=t?t.parentElement.getElementsByClassName("c4g__form-radio-group"):document.querySelectorAll(".reservation_time_button .c4g__form-radio-group"),n=[],a=[],d=[],s=[],o=e.times,u=(o.length,e.captions);document.getElementById("c4g_reservation_id").value&&document.getElementById("c4g_reservation_id").value==e.reservationId||(document.getElementById("c4g_reservation_id").value=e.reservationId),jQuery(document.getElementsByClassName("reservation-id")).show(),jQuery(document.getElementsByClassName("reservation_time_button_"+q))&&jQuery(document.getElementsByClassName("reservation_time_button_"+q)).show();var c,y=0;for(c in o){var v=o[c].time;0<parseInt(o[c].interval)&&(v=o[c].time+"#"+o[c].interval);var m=o[c].interval,h=o[c].objects,g=o[c].name;n[y]=v,a[y]=m,d[y]=h,s[y]=g,y++}var p=document.getElementById("c4g_reservation_object_"+q),f=1,_=0;if(p)for(i=0;i<p.options.length;i++){var Q=p.options[i],b=Q.getAttribute("min")?parseInt(Q.getAttribute("min")):1;(-1==b||b<f)&&(f=b);Q=Q.getAttribute("max")?parseInt(Q.getAttribute("max")):0;(-1==Q||_<Q)&&(_=Q)}var e=document.getElementById("c4g_desiredCapacity_"+q),I=e?e.value:0;if(r)for(i=0;i<r.length;i++){var E=r[i];for(j=0;j<E.children.length;j++){var x=E.children[j];if(!x.style||"display:none"!=x.style)for(k=0;k<x.children.length;k++){var B=x.children[k],C=jQuery(B).val();if(C){namefield=B.getAttribute("name").substr(1);var w,A=checkTimelist(C,n),O=-1,N=0;if(-1!==A)for(l=0;l<d[A].length;l++)-1!=d[A][l].id&&checkMax(d,A,l,C,n,I)&&(N=_?(O=O<d[A][l].act?d[A][l].act:O,d[A][l].percent):O=0);if(0<=O&&(!_||O<_)&&(!I||f<=I&&(!_||I<=_))){let e="",t=!1,r=[];for(l=0;l<d[A].length;l++){var S=d[A][l];if(S.priority&&1==S.priority){t=!0;break}}for(d[A]=shuffle(d[A]),l=0;l<d[A].length;l++){var T=d[A][l];a[A],n[A];t&&T.priority&&1==T.priority?r.splice(0,0,T.id):r.push(T.id);for(var D=0;D<jQuery(p).length;D++)if(p[D].value==T.id){if(t&&T.priority&&1==T.priority){U=T.id;break}if(!t){U=T.id;break}}}for(l=0;l<r.length;l++)0==l?e+=r[l]:e=e+"-"+r[l];jQuery(B).attr("data-object",e),jQuery(B).attr("disabled",!1),jQuery(B).attr("hidden",!1),!s[A]||(w=jQuery(B).attr("id"))&&jQuery('label[for="'+w+'"]').text(s[A]),0<N&&jQuery(B).addClass("radio_object_hurry_up"),U&&-1!=U||(U=r[0]),V?u&&u[V]&&((w=document.getElementById("c4g_reservation_object_"+q))&&jQuery(w).length&&jQuery(w).children("option[value="+V+"]").html(u[V])):hideOptions(q,e,L)}else jQuery(B).attr("disabled",!0),jQuery(B).attr("hidden",!0)}}}}if(handleBrickConditions(),-1!=q){var z=jQuery(".reservation_time_button_"+q+'.formdata input[type = "hidden"]'),R=!1;if(z)for(i=0;i<z.length;i++)if("none"!=z[i].style.display){R=z[i].value;break}var F=jQuery(".reservation_time_button_"+q+' input[type = "radio"]'),M=[];if(F)for(i=0;i<F.length;i++){var W=F[i];W&&isElementReallyShowed(W)&&(R&&W.value===R?G=W:W.value&&M.push(W))}if(!G&&M&&1===M.length)for(i=0;i<M.length;i++){G=M[i];break}!G||jQuery(G).is(":disabled")||jQuery(G).hasClass("radio_object_disabled")||(jQuery(G).prop("checked",!1),jQuery(G).click())}}).finally(function(){document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}))}function checkEventFields(){var e=document.getElementById("c4g_reservation_type"),t=e?e.value:-1,r=jQuery(".reservation-event-object select");if(jQuery(".eventdata").hide(),r&&r.is(":visible")){for(jQuery(document.getElementsByClassName("reservation-id")).show(),i=0;i<r.length;i++)if(r[i]){var n,a,l=-1;if(r[i].value&&(l=t.toString()+"-22"+r[i].value.toString(),jQuery(".eventdata_"+l).show(),jQuery(".eventdata_"+l).children().show()),n=document.getElementsByClassName("begindate-event"))for(j=0;j<n.length;j++)-1!=l&&jQuery(n[j]).children(".c4g__form-date-container").children("input").hasClass("c4g_beginDateEvent_"+l)?(jQuery(n[j]).show(),jQuery(n[j]).children("label").show(),jQuery(n[j]).children(".c4g__form-date-container").show(),jQuery(n[j]).children(".c4g__form-date-container").children("input").show()):(jQuery(n[j]).hide(),jQuery(n[j]).children("label").hide(),jQuery(n[j]).children(".c4g__form-date-container").hide(),jQuery(n[j]).children(".c4g__form-date-container").children("input").hide());if(a=jQuery(".reservation_time_event_button"))for(j=0;j<a.length;j++)-1!=l&&jQuery(a[j]).hasClass("reservation_time_event_button_"+l)?(jQuery(a[j]).show(),jQuery(a[j]).children("label").show(),jQuery(a[j]).parent().show(),jQuery(a[j]).parent().parent().show(),jQuery(a[j]).parent().parent().parent().show()):(jQuery(a[j]).hide(),jQuery(a[j]).children("label").hide(),jQuery(a[j]).parent().hide(),jQuery(a[j]).parent().parent().hide(),jQuery(a[j]).parent().parent().parent().hide())}}else{if((n=jQuery(".begindate-event"))&&jQuery.isArray(n))for(i=0;i<n.length;i++)jQuery(n[i]).hide();if((a=jQuery(".reservation_time_event_button"))&&jQuery.isArray(a))for(i=0;i<a.length;i++)jQuery(a[i]).hide()}}