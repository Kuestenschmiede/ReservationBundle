function getWeekdate(e){var t,n,i,a;return 0<e.indexOf(".")?(n=(t=e.split("."))[2],i=t[1],a=t[0],e=(n=n&&2==n.length?"20"+n:n)+"/"+(i=i<10?"0"+i:i)+"/"+(a=a<10?"0"+a:a)):0<e.indexOf("/")&&(n=(t=e.split("/"))[2],i=t[1],a=t[0],e=(n=n&&2==n.length?"20"+n:n)+"/"+(i=i<10?"0"+i:i)+"/"+(a=a<10?"0"+a:a)),new Date(e).getDay()}function isWeekday(e,t){e=e.split("--");return!!(e&&e[0]&&e[1]&&getWeekdate(e[0])==e[1])}function setObjectId(e,t,n=0){var a,l=!!e&&e.getAttribute("data-object"),r=t,s=document.getElementById("c4g_reservation_object_"+r),o=document.getElementsByClassName("displayReservationObjects"),t="";if(s){if(s.style.display="block",o)for(i=0;i<o.length;i++)o[i].style.display="block";l&&(a=l.split("-"),e.disabled||s.value&&!(s.value<=0)||(s.value=a[0]),handleBrickConditions(),t=a||t)}return hideOptions(r,t,n),!0}function hideOptions(e,t,n){var a;-1==e&&(e=(a=document.getElementById("c4g_reservation_type"))?a.value:-1);var l=document.getElementById("c4g_reservation_object_"+e),r=-1,s=0,o=!1;if(l){var d=0;for(i=0;i<l.options.length;i++){var c=l.options[i],u=c.getAttribute("min")?parseInt(c.getAttribute("min")):1,m=c.getAttribute("max")?parseInt(c.getAttribute("max")):0,y=document.getElementById("c4g_desiredCapacity_"+e),g=y?y.value:0,v=g-u,y=m-g,p=y<v?v:y;c.value&&-1==c.value&&(o=i);var b=!1;if(Array.isArray(t)){if(u&&g&&0<g&&u<=g&&g<=m)for(j=0;j<t.length;j++)t[j]==c.value&&(!d||0==d||p&&0<p&&p<d)&&(d=p||d,s=t[j],b=!0);else for(j=0;j<t.length;j++)if(t[j]==c.value){0==j&&(s=t[j]),b=!0;break}}else 0<=parseInt(t)&&t==c.value&&(s=t,b=!0);if(b||-1==c.value?-1!=c.value&&(c.removeAttribute("disabled"),c.removeAttribute("hidden"),u&&g&&0<g&&(g<u||m&&m<g)?(c.setAttribute("disabled","disabled"),c.setAttribute("hidden","hidden")):(c.removeAttribute("disabled"),c.removeAttribute("hidden"),0<=s&&c.value==s?r=s:-1==r&&-1!=c.value&&(r=c.value))):(c.setAttribute("disabled","disabled"),c.setAttribute("hidden","hidden")),n&&-1!=c.value&&b){var m=c.textContent,f="",_="",h=document.querySelectorAll(".c4g__form-date-container .c4g_beginDate_"+e);if(h)for(k=0;k<h.length;k++){var E=h[k];if(E&&E.value){f=E.value;break}}var A=document.querySelectorAll(".reservation_time_button_"+e+' input[type = "radio"]:checked');if(A)for(k=0;k<A.length;k++){var I=A[k];if(I){I=document.querySelectorAll('label[for="'+I.getAttribute("id")+'"]'),_=I?I[0].firstChild.nodeValue:"";break}}m&&""!=f&&""!=_&&(-1!=(g=m.lastIndexOf(" ("))&&(m=m.substr(0,g)),c.textContent=m+" ("+f+" "+_+")")}}!l.disabled&&l.value&&0<=l.value&&(r=l.value),0<=parseInt(r)?(l.value=r,l.options[r]&&(l.options[r].removeAttribute("disabled"),l.options[r].removeAttribute("hidden")),0!=o&&(l.options[o].setAttribute("disabled","disabled"),l.options[o].setAttribute("hidden","hidden")),l.removeAttribute("disabled")):(0!=o&&(l.options[o].removeAttribute("disabled"),l.options[o].removeAttribute("hidden")),l.value=-1,l.setAttribute("disabled","disabled")),eventFire(l,"change")}checkEventFields()}function checkType(e,t){return t?!!e.parent.parent.classList.contains("begindate-event"):!!e.parent.parent.classList.contains("begin-date")}function setReservationForm(e,t){var n=!(document.getElementsByClassName("reservation-id")[0].style.display="none"),a=!1,l=document.getElementById("c4g_reservation_type");e=l?l.value:-1;var r=l.selectedIndex,r=l.options[r];if(r&&(n=2==r.getAttribute("type"),a=3==r.getAttribute("type")),0<e){r=document.getElementById("c4g_desiredCapacity_"+e);r&&(s=r.value,r.getAttribute("max")&&s>parseInt(r.getAttribute("max"))&&(r.value=r.getAttribute("max")),r.getAttribute("min")&&s<parseInt(r.getAttribute("min"))&&(r.value=r.getAttribute("min")));var s,r=document.getElementById("c4g_duration_"+e);r&&"none"!==r.style.display&&(r.style.display="block",s=r.value,r&&r.getAttribute("max")&&s>parseInt(r.getAttribute("max"))&&(r.value=r.getAttribute("max")),r&&r.getAttribute("min")&&s<parseInt(r.getAttribute("min"))&&(r.value=r.getAttribute("min")));r="c4g_beginDate_"+e;if(a){var o=document.getElementById("c4g_reservation_object_"+e);o&&(r=r+"-33"+o.value,setTimeset(document.getElementById(r),e,t))}else if(n){o=window.location.search;const m=new URLSearchParams(o);o=m.get("event");if(o){r="c4g_beginDateEvent_"+e+"-22"+o;document.getElementById(r)&&(setTimeset(document.getElementById(r),e,t),checkEventFields())}else{var d=document.getElementsByClassName("c4g__form-date-input");if(d)for(i=0;i<d.length;i++){var c=d[i];if(c&&checkType(c,n)&&c.value){var u=c.id;if(u&&u.indexOf("c4g_beginDateEvent_"+e+"-22")){setTimeset(c,e,t),checkEventFields();break}}}}}else document.getElementById(r)&&setTimeset(document.getElementById(r),e,t)}handleBrickConditions(),document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}function checkTimelist(a,l){var r=-1;if(a&&l)for(idx=0;idx<l.length;idx++){let i=0;if(l[idx]){let e=[],t=l[idx].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let n=[];if((a=a.toString()).indexOf("#")?n=a.split("#"):n[0]=a,parseInt(e[0])===parseInt(n[0])&&(r=idx,i++),e[1]&&n[1]){var s=parseInt(e[0]),o=s+parseInt(e[1]),d=parseInt(n[0]),c=d+parseInt(n[1]);if(s<=d&&d<o&&(r=idx,i++),s<c&&c<=o&&(r=idx,i++),3==i)break}else if(e[1]&&n[0]){var u=parseInt(e[0]),m=u+parseInt(e[1]),y=parseInt(n[0]);if(u<=y&&y<=m&&(r=idx,i++),3==i)break}else if(e[0]&&n[1]){u=parseInt(e[0]),y=parseInt(n[0]),m=y+parseInt(n[1]);if(y<=u&&u<=m&&(r=idx,i++),3==i)break}}else if(1==i)break}return r}function checkMax(a,l,r,s,o,e){let d=!0;var c,u,m,g,e=a[l][r].act+parseInt(e);if(a[l][r].max&&e<=a[l][r].max){for(y=0;y<a.length;y++)if(s&&o&&y!=l){let e=[],t=o[y].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let n=[];(s=s.toString()).indexOf("#")?n=s.split("#"):n[0]=s;let i=!1;if(parseInt(e[0])===parseInt(n[0])?i=!0:e[1]&&n[1]&&(u=(c=parseInt(e[0]))+parseInt(e[1]),g=(m=parseInt(n[0]))+parseInt(n[1]),(c<=m&&m<u||c<g&&g<=u)&&(i=!0)),i)for(z=0;z<a[y].length;z++)if(a[y][z].max&&a[y][z].act>=a[y][z].max||a[y][z].act+a[l][r].act>=a[l][r].max)return!1;d=!0}}else d=!a[l][r].max;return d}function shuffle(e){let t=e.length;for(;0<t;){var n=Math.floor(Math.random()*t);t--;var i=e[t];e[t]=e[n],e[n]=i}return e}function eventFire(e,t){var n;e.fireEvent?e.fireEvent("on"+t):((n=document.createEvent("Events")).initEvent(t,!0,!1),e.dispatchEvent(n))}function setTimeset(e,U,V){var G=0,J=-1,K=0;-1==U?(document.getElementsByClassName("reservation_time_button")&&(document.getElementsByClassName("reservation_time_button").style.display="none"),document.getElementsByClassName("displayReservationObjects")&&(document.getElementsByClassName("displayReservationObjects").style.display="none")):(e?e.id&&e.id.indexOf("-33")&&-1!=e.id.indexOf("-33")&&(K=e.id.substr(e.id.indexOf("-33")+3)):e=document.getElementById("c4g_beginDate_"+U),G=e?e.value:0);var t,Q,e=document.getElementById("c4g_duration_"+U);e&&e.style&&"none"!==e.style&&(t=e.value),(G=G&&G.indexOf("/")?(G=G.replace("/","~")).replace("/","~"):G)&&U&&(t=t||-1,Q=!(document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="flex"),fetch("/reservation-api/currentTimeset/"+G+"/"+U+"/"+t+"/"+K).then(e=>e.json()).then(e=>{var t=document.getElementById("c4g_beginTime_"+U+"-00"+getWeekdate(G)),n=t?t.parentElement.getElementsByClassName("c4g__form-radio-group"):document.querySelectorAll(".reservation_time_button .c4g__form-radio-group"),a=[],r=[],s=[],o=[],d=e.times,c=(d.length,e.captions);document.getElementById("c4g_reservation_id").value&&document.getElementById("c4g_reservation_id").value==e.reservationId||(document.getElementById("c4g_reservation_id").value=e.reservationId),document.getElementsByClassName("reservation-id")[0].style.display="block";var u=document.getElementsByClassName("reservation_time_button_"+U);for(i=0;i<u.length;i++)u[i].style.display="block";var m,y=0;for(m in d){var g=d[m].time;0<parseInt(d[m].interval)&&(g=d[m].time+"#"+d[m].interval);var v=d[m].interval,p=d[m].objects,b=d[m].name;a[y]=g,r[y]=v,s[y]=p,o[y]=b,y++}var f=document.getElementById("c4g_reservation_object_"+U),_=1,h=0;if(f)for(i=0;i<f.options.length;i++){var E=f.options[i],A=E.getAttribute("min")?parseInt(E.getAttribute("min")):1;(-1==A||A<_)&&(_=A);E=E.getAttribute("max")?parseInt(E.getAttribute("max")):0;(-1==E||h<E)&&(h=E)}var e=document.getElementById("c4g_desiredCapacity_"+U),I=e?e.value:0;if(n)for(i=0;i<n.length;i++){var B=n[i];for(j=0;j<B.children.length;j++){var x=B.children[j];if(!x.style||"display:none"!=x.style)for(k=0;k<x.children.length;k++){var C=x.children[k],N=C.value;if(N){namefield=C.getAttribute("name").substr(1);var O,S=checkTimelist(N,a),T=-1,q=0;if(-1!==S)for(l=0;l<s[S].length;l++)-1!=s[S][l].id&&checkMax(s,S,l,N,a,I)&&(q=h?(T=T<s[S][l].act?s[S][l].act:T,s[S][l].percent):T=0);if(0<=T&&(!h||T<h)&&(!I||_<=I&&(!h||I<=h))){let e="",t=!1,n=[];for(l=0;l<s[S].length;l++){var F=s[S][l];if(F.priority&&1==F.priority){t=!0;break}}for(s[S]=shuffle(s[S]),l=0;l<s[S].length;l++){var D=s[S][l];r[S],a[S];t&&D.priority&&1==D.priority?n.splice(0,0,D.id):n.push(D.id);for(var w=0;w<f.length;w++)if(f[w].value==D.id){if(t&&D.priority&&1==D.priority){J=D.id;break}if(!t){J=D.id;break}}}for(l=0;l<n.length;l++)0==l?e+=n[l]:e=e+"-"+n[l];if(C.setAttribute("data-object",e),C.disabled=!1,C.style.display,!o[S]||(O=C.getAttribute("id"))&&(document.querySelectorAll('label[for="'+O+'"]').textContent=o[S]),0<q&&C.classList.add("radio_object_hurry_up"),J&&-1!=J||(J=n[0]),K){if(c&&c[K]){var L=document.getElementById("c4g_reservation_object_"+U);if(L&&L.length)for(z=0;z<L.options.length;z++)if(L.options[z].value==K){L.options[z].innerHtml=c[K];break}}}else hideOptions(U,e,V)}else C.setAttribute("disabled",!0),C.setAttribute("hidden",!0)}}}}if(handleBrickConditions(),-1!=U){var R=document.querySelectorAll(".reservation_time_button_"+U+'.formdata input[type = "hidden"]'),M=!1;if(R)for(z=0;z<R.length;z++)if("none"!=R[z].style.display){M=R[z].value;break}var W=document.querySelectorAll(".reservation_time_button_"+U+' input[type = "radio"]'),H=[];if(W&&W.length)for(z=0;z<W.length;z++){var P=W[z];P&&(M&&P.value===M?Q=P:P.value&&H.push(P))}if(!Q&&H&&1===H.length)for(z=0;z<H.length;z++){Q=H[z];break}if(!K)if(!Q||Q.disabled||Q.classList.contains("radio_object_disabled")){for(z=0;z<H.length;z++)H[z].removeAttribute("checked");f.value=-1,eventFire(f,"change"),f.disabled=!0}else Q.removeAttribute("checked"),eventFire(Q,"click"),setObjectId(Q,U,V)}}).finally(function(){document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}))}function checkEventFields(){var e=document.getElementById("c4g_reservation_type"),t=e?e.value:-1,n=document.querySelectorAll(".reservation-event-object select");let a=document.getElementsByClassName(".eventdata");if(a[0]&&(a[0].style.display="none"),n&&document.querySelector("reservation-id:not([hidden])")){for(document.getElementsByClassName("reservation-id"),i=0;i<n.length;i++)if(n[i]){var l,r,s=-1;if((n=n[i])[i].value&&(s=t.toString()+"-22"+n[i].value.toString(),document.getElementsByClassName(".eventdata_"+s).style.display="block",document.getElementsByClassName(".eventdata_"+s).children.style.display="block"),l=document.getElementsByClassName("begindate-event"))for(j=0;j<l.length;j++)-1!=s&&l[j].children.document.getElementsByClassName(".c4g__form-date-container").children("input").classList.contains("c4g_beginDateEvent_"+s)?(l[j].style.display="block",l[j].children("label").style.display="block",l[j].children.document.getElementsByClassName(".c4g__form-date-container").style.display="block",l[j].children.document.getElementsByClassName(".c4g__form-date-container").children("input").style.display="block"):(l[j].style.display="none",l[j].children("label").style.display="none",l[j].children.document.getElementsByClassName(".c4g__form-date-container").style.display="none",l[j].children.document.getElementsByClassName(".c4g__form-date-container").children("input").style.display="none");if(r=document.getElementsByClassName(".reservation_time_event_button"))for(j=0;j<r.length;j++)-1!=s&&r[j].classList.contains("reservation_time_event_button_"+s)?(r[j].style.display="block",r[j].children("label").style.display="block",r[j].parent().style.display="block",r[j].parent().parent().style.display="block",r[j].parent().parent().parent().style.display="block"):(r[j].style.display="none",r[j].children("label").style.display="none",r[j].parent().style.display="none",r[j].parent().parent().style.display="none",r[j].parent().parent().parent().style.display="none")}}else{if((l=document.getElementsByClassName(".begindate-event"))&&Array.isArray(l))for(i=0;i<l.length;i++)l[i].style.display="none";if((r=document.getElementsByClassName(".reservation_time_event_button"))&&Array.isArray(r))for(i=0;i<r.length;i++)r[i].style.display="none"}}