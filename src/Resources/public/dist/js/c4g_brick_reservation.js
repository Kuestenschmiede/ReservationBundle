function getWeekdate(e){var t,i,n,a;return 0<e.indexOf(".")?(i=(t=e.split("."))[2],n=t[1],a=t[0],e=(i=i&&2==i.length?"20"+i:i)+"/"+(n=n<10?"0"+n:n)+"/"+(a=a<10?"0"+a:a)):0<e.indexOf("/")&&(i=(t=e.split("/"))[2],n=t[1],a=t[0],e=(i=i&&2==i.length?"20"+i:i)+"/"+(n=n<10?"0"+n:n)+"/"+(a=a<10?"0"+a:a)),new Date(e).getDay()}function isWeekday(e,t){e=e.split("--");return!!(e&&e[0]&&e[1]&&getWeekdate(e[0])==e[1])}function setObjectId(e,t,n=0){var a=!!e&&e.getAttribute("data-object"),e=t,l=document.getElementById("c4g_reservation_object_"+e),r=document.getElementsByClassName("displayReservationObjects"),t="",s=!1;if(l){if(l.style.display="block",s=l.value&&0<parseInt(l.value)?l.value:s,r)for(i=0;i<r.length;i++)r[i].style.display="block";if(a){var o=a.split("-"),d=!1;for(i=0;i<o.length;i++){for(j=0;j<l.options.length;j++)if(!l.options[j].getAttribute("hidden")&&l.options[j].value==o[i]){l.value=o[i],handleBrickConditions(),d=!0;break}if(d)break}t=o||t}}if(hideOptions(e,t,n),s)for(i=0;i<l.options.length;i++)if(!l.options[i].getAttribute("hidden")&&l.options[i].value==s){l.value=s,handleBrickConditions();break}if(l&&-1!=parseInt(l.value))for(i=0;i<l.options.length;i++)if(-1==parseInt(l.options[i].value)&&"none"!=l.options[i].style.display){l.options[i].style.display="none";break}return hideOptions(e,t,n),!0}function hideOptions(e,t,n){var a;-1==e&&(e=(a=document.getElementById("c4g_reservation_type"))?a.value:-1);var l=document.getElementById("c4g_reservation_object_"+e),r=-1,s=0,o=!1;if(l){var d=0;for(i=0;i<l.options.length;i++){var c=l.options[i],m=c.getAttribute("min")?parseInt(c.getAttribute("min")):1,u=c.getAttribute("max")?parseInt(c.getAttribute("max")):0,g=document.getElementById("c4g_desiredCapacity_"+e),y=g?g.value:0,p=y-m,g=u-y,v=g<p?p:g;c.value&&-1==c.value&&(o=i);var b=!1;if(Array.isArray(t)){if(m&&y&&0<y&&m<=y&&y<=u)for(j=0;j<t.length;j++)t[j]==c.value&&(!d||0==d||v&&0<v&&v<d)&&(d=v||d,s=t[j],b=!0);else for(j=0;j<t.length;j++)if(t[j]==c.value){0==j&&(s=t[j]),b=!0;break}}else 0<=parseInt(t)&&t==c.value&&(s=t,b=!0);if(b||-1==c.value?-1!=c.value&&(c.removeAttribute("disabled"),c.removeAttribute("hidden"),m&&y&&0<y&&(y<m||u&&u<y)?(c.setAttribute("disabled","disabled"),c.setAttribute("hidden","hidden")):(c.removeAttribute("disabled"),c.removeAttribute("hidden"),0<=s&&c.value==s?r=s:-1==r&&-1!=c.value&&(r=c.value))):(c.setAttribute("disabled","disabled"),c.setAttribute("hidden","hidden")),n&&-1!=c.value&&b){var u=c.textContent,f="",h="",_=document.querySelectorAll(".c4g__form-date-container .c4g_beginDate_"+e);if(_)for(k=0;k<_.length;k++){var E=_[k];if(E&&E.value){f=E.value;break}}var I=document.querySelectorAll(".reservation_time_button_"+e+' input[type = "radio"]:checked');if(I)for(k=0;k<I.length;k++){var B=I[k];if(B){B=B.parentNode.getElementsByTagName("label")[0],h=B?B.value:"";break}}u&&""!=f&&""!=h&&(-1!=(y=u.lastIndexOf(" ("))&&(u=u.substr(0,y)),c.textContent=u+" ("+f+" "+h+")")}}!l.disabled&&l.value&&0<=l.value&&(r=l.value),0<=parseInt(r)?(l.options[r]?(l.value=r,l.options[r].removeAttribute("disabled"),l.options[r].removeAttribute("hidden")):0!=o&&(l.options[o].setAttribute("disabled","disabled"),l.options[o].setAttribute("hidden","hidden")),l.removeAttribute("disabled")):(0!=o&&(l.options[o].removeAttribute("disabled"),l.options[o].removeAttribute("hidden")),l.value=-1,l.setAttribute("disabled","disabled")),eventFire(l,"change")}checkEventFields()}function checkType(e,t){return t?!!e.parent.parent.classList.contains("begindate-event"):!!e.parent.parent.classList.contains("begin-date")}function setReservationForm(e,t){var n=!(document.getElementsByClassName("reservation-id")[0].style.display="none"),a=!1,l=document.getElementById("c4g_reservation_type");e=l?l.value:-1;var r=l.selectedIndex,r=l.options[r];if(r&&(n=2==r.getAttribute("type"),a=3==r.getAttribute("type")),0<e){r=document.getElementById("c4g_desiredCapacity_"+e);r&&(s=r.value,r.getAttribute("max")&&s>parseInt(r.getAttribute("max"))&&(r.value=r.getAttribute("max")),r.getAttribute("min")&&s<parseInt(r.getAttribute("min"))&&(r.value=r.getAttribute("min")));var s,r=document.getElementById("c4g_duration_"+e);r&&"none"!==r.style.display&&(r.style.display="block",s=r.value,r&&r.getAttribute("max")&&s>parseInt(r.getAttribute("max"))&&(r.value=r.getAttribute("max")),r&&r.getAttribute("min")&&s<parseInt(r.getAttribute("min"))&&(r.value=r.getAttribute("min")));r="c4g_beginDate_"+e;if(a){var o=document.getElementById("c4g_reservation_object_"+e);o&&(r=r+"-33"+o.value,setTimeset(document.getElementById(r),e,t))}else if(n){o=window.location.search;const u=new URLSearchParams(o);o=u.get("event");if(o){r="c4g_beginDateEvent_"+e+"-22"+o;document.getElementById(r)&&(setTimeset(document.getElementById(r),e,t),checkEventFields())}else{var d=document.getElementsByClassName("c4g__form-date-input");if(d)for(i=0;i<d.length;i++){var c=d[i];if(c&&checkType(c,n)&&c.value){var m=c.id;if(m&&m.indexOf("c4g_beginDateEvent_"+e+"-22")){setTimeset(c,e,t),checkEventFields();break}}}}}else document.getElementById(r)&&setTimeset(document.getElementById(r),e,t)}handleBrickConditions(),document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}function checkTimelist(a,l){var r=-1;if(a&&l)for(idx=0;idx<l.length;idx++){let n=0;if(l[idx]){let e=[],t=l[idx].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let i=[];if((a=a.toString()).indexOf("#")?i=a.split("#"):i[0]=a,parseInt(e[0])===parseInt(i[0])&&(r=idx,n++),e[1]&&i[1]){var s=parseInt(e[0]),o=s+parseInt(e[1]),d=parseInt(i[0]),c=d+parseInt(i[1]);if(s<=d&&d<o&&(r=idx,n++),s<c&&c<=o&&(r=idx,n++),3==n)break}else if(e[1]&&i[0]){var m=parseInt(e[0]),u=m+parseInt(e[1]),g=parseInt(i[0]);if(m<=g&&g<=u&&(r=idx,n++),3==n)break}else if(e[0]&&i[1]){m=parseInt(e[0]),g=parseInt(i[0]),u=g+parseInt(i[1]);if(g<=m&&m<=u&&(r=idx,n++),3==n)break}}else if(1==n)break}return r}function checkMax(a,l,r,s,o,e){let d=!0;var c,m,u,g,e=a[l][r].act+parseInt(e);if(a[l][r].max&&e<=a[l][r].max){for(y=0;y<a.length;y++)if(s&&o&&y!=l){let e=[],t=o[y].toString();t&&t.indexOf("#")?e=t.split("#"):e[0]=t;let i=[];(s=s.toString()).indexOf("#")?i=s.split("#"):i[0]=s;let n=!1;if(parseInt(e[0])===parseInt(i[0])?n=!0:e[1]&&i[1]&&(m=(c=parseInt(e[0]))+parseInt(e[1]),g=(u=parseInt(i[0]))+parseInt(i[1]),(c<=u&&u<m||c<g&&g<=m)&&(n=!0)),n)for(z=0;z<a[y].length;z++)if(a[y][z].max&&a[y][z].act>=a[y][z].max||a[y][z].act+a[l][r].act>=a[l][r].max)return!1;d=!0}}else d=!a[l][r].max;return d}function shuffle(e){let t=e.length;for(;0<t;){var i=Math.floor(Math.random()*t);t--;var n=e[t];e[t]=e[i],e[i]=n}return e}function isElementReallyShowed(e){var t=!e.disabled&&"none"!=e.style.display,n=e&&e.parent?e.parent.parent.children:[];if(n&&n.length)for(i=0;i<n.length;i++)t=t&&!n[i].disabled&&"none"!=n[i].style.display&&document.querySelector("#"+n[i].getAttribute("id")+":not([hidden])");return t}function setTimeset(e,P,U){var G=0,J=-1,K=0;-1==P?(document.getElementsByClassName("reservation_time_button")&&(document.getElementsByClassName("reservation_time_button").style.display="none"),document.getElementsByClassName("displayReservationObjects")&&(document.getElementsByClassName("displayReservationObjects").style.display="none")):(e?e.id&&e.id.indexOf("-33")&&-1!=e.id.indexOf("-33")&&(K=e.id.substr(e.id.indexOf("-33")+3)):e=document.getElementById("c4g_beginDate_"+P),G=e?e.value:0);e=document.getElementById("c4g_duration_"+P);e&&e.style&&"none"!==e.style&&(t=e.value);var t,n,Q,e=document.getElementById("c4g_desiredCapacity_"+P);e&&e.style&&"none"!==e.style&&(n=e.value),(G=G&&G.indexOf("/")?(G=G.replace("/","~")).replace("/","~"):G)&&P&&(t=t||-1,n=n||-1,Q=!(document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="flex"),fetch("/reservation-api/currentTimeset/"+G+"/"+P+"/"+t+"/"+n+"/"+K).then(e=>e.json()).then(e=>{var t=document.getElementById("c4g_beginTime_"+P+"-00"+getWeekdate(G)),n=t?t.parentElement.getElementsByClassName("c4g__form-radio-group"):document.querySelectorAll(".reservation_time_button .c4g__form-radio-group"),a=[],r=[],s=[],o=[],d=e.times,c=(d.length,e.captions);document.getElementById("c4g_reservation_id").value&&document.getElementById("c4g_reservation_id").value==e.reservationId||(document.getElementById("c4g_reservation_id").value=e.reservationId),document.getElementsByClassName("reservation-id")[0].style.display="block";var m=document.getElementsByClassName("reservation_time_button_"+P);for(i=0;i<m.length;i++)m[i].style.display="block";var u,g=0;for(u in d){var y=d[u].time;0<parseInt(d[u].interval)&&(y=d[u].time+"#"+d[u].interval);var p=d[u].interval,v=d[u].objects,b=d[u].name;a[g]=y,r[g]=p,s[g]=v,o[g]=b,g++}var f=document.getElementById("c4g_reservation_object_"+P),h=1,_=0;if(f)for(i=0;i<f.options.length;i++){var E=f.options[i],I=E.getAttribute("min")?parseInt(E.getAttribute("min")):1;(-1==I||I<h)&&(h=I);E=E.getAttribute("max")?parseInt(E.getAttribute("max")):0;(-1==E||_<E)&&(_=E)}var e=document.getElementById("c4g_desiredCapacity_"+P),B=e?e.value:0;if(n)for(i=0;i<n.length;i++){var A=n[i];for(j=0;j<A.children.length;j++){var x=A.children[j];if(!x.style||"display:none"!=x.style)for(k=0;k<x.children.length;k++){var N=x.children[k],C=N.value;if(C){namefield=N.getAttribute("name").substr(1);var O=checkTimelist(C,a),T=-1,S=0;if(-1!==O)for(l=0;l<s[O].length;l++)-1!=s[O][l].id&&checkMax(s,O,l,C,a,B)&&(S=_?(T=T<s[O][l].act?s[O][l].act:T,s[O][l].percent):T=0);if(0<=T&&(!_||T<_)&&(!B||h<=B&&(!_||B<=_))){let e="",t=!1,i=[];for(l=0;l<s[O].length;l++){var F=s[O][l];if(F.priority&&1==F.priority){t=!0;break}}for(s[O]=shuffle(s[O]),l=0;l<s[O].length;l++){var q=s[O][l];r[O],a[O];t&&q.priority&&1==q.priority?i.splice(0,0,q.id):i.push(q.id);for(var w=0;w<f.length;w++)if(f[w].value==q.id){if(t&&q.priority&&1==q.priority){J=q.id;break}if(!t){J=q.id;break}}}for(l=0;l<i.length;l++)0==l?e+=i[l]:e=e+"-"+i[l];if(N.setAttribute("data-object",e),N.disabled=!1,N.style.display="block",o[O]&&N.getAttribute("id")&&(N.parentNode.getElementsByTagName("label")[0].innerHTML=o[O]),0<S&&N.classList.add("radio_object_hurry_up"),J&&-1!=J||(J=i[0]),K){if(c&&c[K]){var D=document.getElementById("c4g_reservation_object_"+P);if(D&&D.length)for(z=0;z<D.options.length;z++)if(D.options[z].value==K){D.options[z].innerHtml=c[K];break}}}else hideOptions(P,e,U)}else N.setAttribute("disabled",!0),N.setAttribute("hidden",!0)}}}}if(handleBrickConditions(),-1!=P){var L=document.querySelectorAll(".reservation_time_button_"+P+'.formdata input[type = "hidden"]'),R=!1;if(L)for(z=0;z<L.length;z++)if("none"!=L[z].style.display){R=L[z].value;break}var M=document.querySelectorAll(".reservation_time_button_"+P+' input[type = "radio"]'),W=[];if(M&&M.length)for(z=0;z<M.length;z++){var H=M[z];H&&(R&&H.value===R?Q=H:H.value&&W.push(H))}if(!Q&&W&&1===W.length)for(z=0;z<W.length;z++){Q=W[z];break}if(!K&&f&&(setObjectId(0,P,U),f.value=-1,eventFire(f,"change"),f.disabled=!0),!K)if(!Q||Q.disabled||Q.classList.contains("radio_object_disabled")){for(z=0;z<W.length;z++)W[z].removeAttribute("checked");f&&(f.value=-1,eventFire(f,"change"),f.disabled=!0)}else Q.removeAttribute("checked"),eventFire(Q,"click"),setObjectId(Q,P,U)}}).finally(function(){document.getElementsByClassName("c4g__spinner-wrapper")[0].style.display="none"}))}function checkEventFields(){var e=document.getElementById("c4g_reservation_type"),t=e?e.value:-1,n=document.querySelector(".reservation-event-object select");let a=document.getElementsByClassName("eventdata");if(a[0]&&(a[0].style.display="none"),n&&document.querySelector("reservation-id:not([hidden])")){for(document.getElementsByClassName("reservation-id"),i=0;i<n.length;i++)if(n[i]){var l,r,s=-1;if((n=n[i])[i].value&&(s=t.toString()+"-22"+n[i].value.toString(),document.getElementsByClassName("eventdata_"+s).style.display="block",document.getElementsByClassName("eventdata_"+s).children[0].style.display="block"),l=document.getElementsByClassName("begindate-event"))for(j=0;j<l.length;j++)-1!=s&&l[j].children[0].getElementsByClassName("c4g__form-date-container")[0].children[0].getElementsByTagName("input")[0].classList.contains("c4g_beginDateEvent_"+s)?(l[j].style.display="block",l[j].children[0].getElementsByTagName("label")[0].style.display="block",l[j].children[0].getElementsByClassName("c4g__form-date-container")[0].style.display="block",l[j].children[0].getElementsByClassName("c4g__form-date-container")[0].children[0].getElementsByTagName("input")[0].style.display="block"):(l[j].style.display="none",l[j].getElementsByTagName("label")[0].style.display="none",l[j].children[0].getElementsByClassName("c4g__form-date-container")[0].style.display="none",l[j].children[0].getElementsByClassName("c4g__form-date-container")[0].children[0].getElementsByTagName("input")[0].style.display="none");if(r=document.getElementsByClassName("reservation_time_event_button"))for(j=0;j<r.length;j++)-1!=s&&r[j].classList.contains("reservation_time_event_button_"+s)?(r[j].style.display="block",r[j].children[0].getElementsByTagName("label")[0].style.display="block",r[j].parent.style.display="block",r[j].parent.parent.style.display="block",r[j].parent.parent.parent.style.display="block"):(r[j].style.display="none",r[j].children[0].getElementsByTagName("label")[0].style.display="none",r[j].parent.style.display="none",r[j].parent.parent.style.display="none",r[j].parent.parent.parent.style.display="none")}}else{if((l=document.getElementsByClassName("begindate-event"))&&Array.isArray(l))for(i=0;i<l.length;i++)l[i].style.display="none";if((r=document.getElementsByClassName("reservation_time_event_button"))&&Array.isArray(r))for(i=0;i<r.length;i++)r[i].style.display="none"}}